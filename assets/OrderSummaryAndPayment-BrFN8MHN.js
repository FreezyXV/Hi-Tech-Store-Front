import{a as Ee,R as u,r as L,j as c,E as xe,F as be,G as je,t as Pe,u as we,H as Oe}from"./index-B0peXRIU.js";import{F as ke}from"./Footer-C0FuPijp.js";import"react-toastify";import"react-toastify/dist/ReactToastify.css";var oe="https://js.stripe.com/v3",Ne=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,H="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Re=function(){for(var e=document.querySelectorAll('script[src^="'.concat(oe,'"]')),t=0;t<e.length;t++){var n=e[t];if(Ne.test(n.src))return n}return null},Q=function(e){var t="",n=document.createElement("script");n.src="".concat(oe).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},Ae=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"5.1.0",startTime:t})},T=null,q=null,M=null,Te=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},_e=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Le=function(e){return T!==null?T:(T=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(H),window.Stripe){t(window.Stripe);return}try{var a=Re();if(a&&e)console.warn(H);else if(!a)a=Q(e);else if(a&&M!==null&&q!==null){var o;a.removeEventListener("load",M),a.removeEventListener("error",q),(o=a.parentNode)===null||o===void 0||o.removeChild(a),a=Q(e)}M=_e(t,n),q=Te(n),a.addEventListener("load",M),a.addEventListener("error",q)}catch(l){n(l);return}}),T.catch(function(t){return T=null,Promise.reject(t)}))},Ie=function(e,t,n){if(e===null)return null;var a=e.apply(void 0,t);return Ae(a,n),a},_,se=!1,ie=function(){return _||(_=Le(null).catch(function(e){return _=null,Promise.reject(e)}),_)};Promise.resolve().then(function(){return ie()}).catch(function(r){se||console.warn(r)});var We=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];se=!0;var a=Date.now();return ie().then(function(o){return Ie(o,t,a)})},ce={exports:{}},Fe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Ue=Fe,qe=Ue;function ue(){}function le(){}le.resetWarningCache=ue;var Me=function(){function r(n,a,o,l,d,s){if(s!==qe){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}r.isRequired=r;function e(){return r}var t={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:e,element:r,elementType:r,instanceOf:e,node:r,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:le,resetWarningCache:ue};return t.PropTypes=t,t};ce.exports=Me();var De=ce.exports;const p=Ee(De);function Z(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function ee(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Z(Object(t),!0).forEach(function(n){pe(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function D(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?D=function(e){return typeof e}:D=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(r)}function pe(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function de(r,e){return Be(r)||$e(r,e)||ze(r,e)||Ke()}function Be(r){if(Array.isArray(r))return r}function $e(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],a=!0,o=!1,l,d;try{for(t=t.call(r);!(a=(l=t.next()).done)&&(n.push(l.value),!(e&&n.length===e));a=!0);}catch(s){o=!0,d=s}finally{try{!a&&t.return!=null&&t.return()}finally{if(o)throw d}}return n}}function ze(r,e){if(r){if(typeof r=="string")return te(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return te(r,e)}}function te(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Ke(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=function(e,t,n){var a=!!n,o=u.useRef(n);u.useEffect(function(){o.current=n},[n]),u.useEffect(function(){if(!a||!e)return function(){};var l=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,l),function(){e.off(t,l)}},[a,t,e,o])},Y=function(e){var t=u.useRef(e);return u.useEffect(function(){t.current=e},[e]),t.current},R=function(e){return e!==null&&D(e)==="object"},Xe=function(e){return R(e)&&typeof e.then=="function"},Ye=function(e){return R(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},re="[object Object]",Je=function r(e,t){if(!R(e)||!R(t))return e===t;var n=Array.isArray(e),a=Array.isArray(t);if(n!==a)return!1;var o=Object.prototype.toString.call(e)===re,l=Object.prototype.toString.call(t)===re;if(o!==l)return!1;if(!o&&!n)return e===t;var d=Object.keys(e),s=Object.keys(t);if(d.length!==s.length)return!1;for(var v={},y=0;y<d.length;y+=1)v[d[y]]=!0;for(var S=0;S<s.length;S+=1)v[s[S]]=!0;var h=Object.keys(v);if(h.length!==d.length)return!1;var i=e,g=t,x=function(O){return r(i[O],g[O])};return h.every(x)},fe=function(e,t,n){return R(e)?Object.keys(e).reduce(function(a,o){var l=!R(t)||!Je(e[o],t[o]);return n.includes(o)?(l&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),a):l?ee(ee({},a||{}),{},pe({},o,e[o])):a},null):null},me="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ne=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:me;if(e===null||Ye(e))return e;throw new Error(t)},Ge=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:me;if(Xe(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(a){return ne(a,t)})};var n=ne(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},Ve=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.9.0"}),e.registerAppInfo({name:"react-stripe-js",version:"2.9.0",url:"https://stripe.com/docs/stripe-js/react"}))},B=u.createContext(null);B.displayName="ElementsContext";var ve=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},he=function(e){var t=e.stripe,n=e.options,a=e.children,o=u.useMemo(function(){return Ge(t)},[t]),l=u.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(n):null}}),d=de(l,2),s=d[0],v=d[1];u.useEffect(function(){var h=!0,i=function(x){v(function(j){return j.stripe?j:{stripe:x,elements:x.elements(n)}})};return o.tag==="async"&&!s.stripe?o.stripePromise.then(function(g){g&&h&&i(g)}):o.tag==="sync"&&!s.stripe&&i(o.stripe),function(){h=!1}},[o,s,n]);var y=Y(t);u.useEffect(function(){y!==null&&y!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[y,t]);var S=Y(n);return u.useEffect(function(){if(s.elements){var h=fe(n,S,["clientSecret","fonts"]);h&&s.elements.update(h)}},[n,S,s.elements]),u.useEffect(function(){Ve(s.stripe)},[s.stripe]),u.createElement(B.Provider,{value:s},a)};he.propTypes={stripe:p.any,options:p.object};var He=function(e){var t=u.useContext(B);return ve(t,e)},Qe=function(){var e=He("calls useElements()"),t=e.elements;return t};p.func.isRequired;var ye=u.createContext(null);ye.displayName="CheckoutSdkContext";var Ze=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},et=u.createContext(null);et.displayName="CheckoutContext";p.any,p.shape({clientSecret:p.string.isRequired,elementsOptions:p.object}).isRequired;var J=function(e){var t=u.useContext(ye),n=u.useContext(B);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?Ze(t,e):ve(n,e)},tt=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f=function(e,t){var n="".concat(tt(e),"Element"),a=function(s){var v=s.id,y=s.className,S=s.options,h=S===void 0?{}:S,i=s.onBlur,g=s.onFocus,x=s.onReady,j=s.onChange,O=s.onEscape,k=s.onClick,I=s.onLoadError,A=s.onLoaderStart,$=s.onNetworksChange,z=s.onConfirm,N=s.onCancel,w=s.onShippingAddressChange,ge=s.onShippingRateChange,W=J("mounts <".concat(n,">")),F="elements"in W?W.elements:null,U="checkoutSdk"in W?W.checkoutSdk:null,Se=u.useState(null),G=de(Se,2),C=G[0],Ce=G[1],P=u.useRef(null),K=u.useRef(null);E(C,"blur",i),E(C,"focus",g),E(C,"escape",O),E(C,"click",k),E(C,"loaderror",I),E(C,"loaderstart",A),E(C,"networkschange",$),E(C,"confirm",z),E(C,"cancel",N),E(C,"shippingaddresschange",w),E(C,"shippingratechange",ge),E(C,"change",j);var X;x&&(e==="expressCheckout"?X=x:X=function(){x(C)}),E(C,"ready",X),u.useLayoutEffect(function(){if(P.current===null&&K.current!==null&&(F||U)){var b=null;U?b=U.createElement(e,h):F&&(b=F.create(e,h)),P.current=b,Ce(b),b&&b.mount(K.current)}},[F,U,h]);var V=Y(h);return u.useEffect(function(){if(P.current){var b=fe(h,V,["paymentRequest"]);b&&"update"in P.current&&P.current.update(b)}},[h,V]),u.useLayoutEffect(function(){return function(){if(P.current&&typeof P.current.destroy=="function")try{P.current.destroy(),P.current=null}catch{}}},[]),u.createElement("div",{id:v,className:y,ref:K})},o=function(s){J("mounts <".concat(n,">"));var v=s.id,y=s.className;return u.createElement("div",{id:v,className:y})},l=t?o:a;return l.propTypes={id:p.string,className:p.string,onChange:p.func,onBlur:p.func,onFocus:p.func,onReady:p.func,onEscape:p.func,onClick:p.func,onLoadError:p.func,onLoaderStart:p.func,onNetworksChange:p.func,onConfirm:p.func,onCancel:p.func,onShippingAddressChange:p.func,onShippingRateChange:p.func,options:p.object},l.displayName=n,l.__elementType=e,l},m=typeof window>"u",rt=u.createContext(null);rt.displayName="EmbeddedCheckoutProviderContext";var nt=function(){var e=J("calls useStripe()"),t=e.stripe;return t};f("auBankAccount",m);var ae=f("card",m);f("cardNumber",m);f("cardExpiry",m);f("cardCvc",m);f("fpxBank",m);f("iban",m);f("idealBank",m);f("p24Bank",m);f("epsBank",m);f("payment",m);f("expressCheckout",m);f("currencySelector",m);f("paymentRequestButton",m);f("linkAuthentication",m);f("address",m);f("shippingAddress",m);f("paymentMethodMessaging",m);f("affirmMessage",m);f("afterpayClearpayMessage",m);const at=({cartItems:r,totalAmount:e,shippingAddress:t,deliveryMethod:n,validateForm:a,onSuccess:o})=>{const l=nt(),d=Qe(),[s,v]=L.useState(!1),[y,S]=L.useState(null),h={base:{color:"#222",fontFamily:"'Muli', sans-serif",fontSize:"22px","::placeholder":{color:"#aaa"}},invalid:{color:"#ff5252"},complete:{color:"#4caf50"}},i=async()=>{var O;if(!a()){alert("Please fill all required fields.");return}const g=d.getElement(ae);if(!g){alert("Please enter your card details.");return}const x=n.toLowerCase()==="express"?15:5,j=e+x;try{v(!0),S(null);const k={items:r.map(w=>({id:w.variant._id,quantity:w.quantity})),totalAmount:j,deliveryMethod:n,shippingAddress:t},{clientSecret:I}=await xe(k);if(!I)throw new Error("Unable to process payment at the moment. Please try again later.");const{error:A,paymentIntent:$}=await l.confirmCardPayment(I,{payment_method:{card:g,billing_details:{name:t.fullName,address:{line1:t.address,city:t.city,postal_code:t.postalCode,country:t.country}}}});if(A){console.error("Payment Error:",A.message),S(A.message);return}const z={items:r.map(w=>({variant:w.variant._id,quantity:w.quantity,price:w.variant.price})),shippingAddress:t,deliveryMethod:n,totalAmount:j,paymentIntentId:$.id},N=await be(z);if(!((O=N==null?void 0:N.order)!=null&&O._id))throw new Error("Failed to place the order. Please try again.");o(N.order._id)}catch(k){console.error("Order Placement Error:",k.message),S(k.message||"Order placement failed.")}finally{v(!1)}};return c.jsxs("div",{className:"payment-method",children:[c.jsx("h2",{children:"Payment Method"}),c.jsx(ae,{options:{style:h}}),y&&c.jsx("p",{className:"error-message",children:y}),c.jsx("button",{onClick:i,disabled:s,className:"submit-order-btn",children:s?"Processing Payment...":"Place Order"})]})},ot=We("pk_test_51QTivwDh91LKzXdS7Bu2GYnkIbXZhnJhf6dmMAiSiEFkh1K1zYRcTCZ7pr8omI4bzND0dhQW2J1XeWfCXz1ttKw000oXR2NepJ"),lt=()=>{const r=je(),e=Pe(),t=we(),{cartItems:n,totalAmount:a}=r.state||{cartItems:[],totalAmount:0},[o,l]=L.useState({fullName:"",address:"",city:"",postalCode:"",country:""}),[d,s]=L.useState("standard"),[v,y]=L.useState({}),S=()=>{const i={};return Object.entries(o).forEach(([g,x])=>{if(!x.trim()){const j=g.charAt(0).toUpperCase()+g.slice(1);i[g]=`${j} is required.`}}),y(i),Object.keys(i).length===0},h=i=>{t(Oe()),e(`/order-confirmation/${i}`)};return c.jsxs("div",{className:"body",children:[c.jsx(he,{stripe:ot,children:c.jsx("div",{className:"order-summary-page",children:c.jsxs("div",{className:"order-summary-container",children:[c.jsx("h1",{children:"Order Summary"}),c.jsxs("div",{className:"order-summary",children:[n.map(i=>c.jsxs("div",{className:"order-summary-item",children:[c.jsx("img",{src:i.variant.imageUrls[0]||"placeholder.jpg",alt:i.variant.name,className:"order-item-image"}),c.jsxs("div",{className:"order-item-details",children:[c.jsx("p",{className:"item-name",children:i.variant.name}),c.jsxs("p",{className:"item-price",children:[i.quantity," x €",i.variant.price.toFixed(2)]})]})]},i.variant._id)),c.jsxs("h2",{className:"total-amount",children:["Total: €",a.toFixed(2)]})]}),c.jsxs("div",{className:"delivery-details",children:[c.jsx("h2",{children:"Shipping Address"}),c.jsx("form",{children:["fullName","address","city","postalCode","country"].map(i=>c.jsxs("div",{className:"form-group",children:[c.jsx("label",{htmlFor:i,children:i.charAt(0).toUpperCase()+i.slice(1)}),c.jsx("input",{type:"text",id:i,name:i,value:o[i],onChange:g=>l({...o,[i]:g.target.value}),className:v[i]?"input-error":""}),v[i]&&c.jsx("span",{className:"error-message",children:v[i]})]},i))})]}),c.jsxs("div",{className:"delivery-method",children:[c.jsx("h2",{children:"Delivery Method"}),c.jsxs("div",{className:"radioLabel",children:[c.jsxs("label",{children:[c.jsx("input",{type:"radio",name:"deliveryMethod",value:"standard",checked:d==="standard",onChange:i=>s(i.target.value),className:"radio"}),"Standard (€5.00)"]}),c.jsxs("label",{children:[c.jsx("input",{type:"radio",name:"deliveryMethod",value:"express",checked:d==="express",onChange:i=>s(i.target.value),className:"radio"}),"Express (€15.00)"]})]})]}),c.jsx(at,{cartItems:n,totalAmount:a,shippingAddress:o,deliveryMethod:d,validateForm:S,onSuccess:h})]})})}),c.jsx(ke,{})]})};export{lt as default};
